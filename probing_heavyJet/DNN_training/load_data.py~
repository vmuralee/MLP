# Created by Vinaya Krishnan
# vinaya.krishna@cern.ch

import ROOT
from root_numpy import root2array, rec2array, array2root, tree2array
import pandas as pd
from sklearn.utils import shuffle

class LoadData:
    def __init__(self,path,filenames,var):
        self.path = path
        self.filenames = filenames
        self.var = var
        for filename in self.filenames:
            print(f"loading data from {self.path}/{filename}")
    def variable_list(self):
        variables = self.var
        return variables
    def getTree(self,filename):
        cols_list = self.var+['target']
        file_ = ROOT.TFile(self.path+'/'+filename)
        if("gg" or "qq" or "ug" in filename):
            treename = 'TreeS'
        else:
            treename = 'TreeB'
        tree = file_.Get(treename)
        tree_arr = tree2array(tree)
        tree_df = pd.DataFrame(tree_arr,columns=cols_list)
        if("gg" in filename):tree_df['target']=00
        if("ug" in filename):tree_df['target']=10
        if("qq" in filename):tree_df['target']=11
        if("SMbkg" in filename):tree_df['target']=1100
        return tree_df
    def load(self,filenames):
        cols_list = self.var+['target']
        filenames = self.filenames
        data = pd.DataFrame(columns=cols_list]
        for filename in filenames:
            tmp_df = self.getTree(filename)
            data.append(tmp_df,ignore_index=True,sort=False)
        for _ in range(8):data = shuffle(data)
        return data
            
    
filenames = ['pp2jj_SMbkg-Nev2e6-ptJetMin700-antiktR0.4-zcut0.1-beta1.0.root',
             'pp2octet2gg-Nev2e6-ptJetMin700-antiktR0.4-zcut0.1-beta1.0.root']
data = LoadData('../Ntuples',filenames,[1,2])
data.variable_list()
